# 《基于 AI 智能客服的牙科修复复诊提醒与管理系统》
## 毕业设计组成说明文档

> **编制依据**：昆明理工大学津桥学院《毕业设计（论文）开题报告》  
> **适用场景**：任务分解、开发实施、中期检查、答辩准备  
> **编制日期**：2026 年 2 月 21 日
> **版本**：v1.2（内容校对与完善）

---

## 一、系统概述

### 1.1 项目背景与目标

在牙科修复临床治疗中，患者术后漏复诊、治疗依从性低是普遍存在的问题，直接影响治疗效果与医疗安全。本设计旨在构建一套**基于 AI 智能客服的牙科修复复诊提醒与管理系统**，通过微信小程序为患者提供 7×24 小时智能随访服务，通过自动化提醒与专业咨询降低漏复诊率，提升患者治疗依从性。

### 1.2 系统定位

| 维度 | 说明 |
|------|------|
| **系统类型** | 医疗健康类软件系统（前后端分离 + AI 智能中枢 + 多端协同） |
| **服务对象** | 患者（微信小程序）、医护人员（Streamlit 管理后台） |
| **核心价值** | 降低漏复诊率、提升治疗依从性、保障医疗安全、减轻医护工作负担 |
| **技术特征** | 自然语言对话、自动化任务调度、领域知识库驱动、人机协同干预 |

---

## 二、系统组成结构（五大核心模块）

本系统由**五大核心模块**组成，各模块职责清晰、逻辑解耦，协同支撑"智能随访"核心业务目标。

```
┌─────────────────────────────────────────────────────────────────┐
│                     基于 AI 智能客服的牙科修复复诊提醒与管理系统                      │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐             │
│  │  微信小程序  │  │ Streamlit 后台│  │   AI 引擎    │             │
│  │   (患者端)   │  │   (医护端)   │  │  (智能客服)  │             │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘             │
│         │                │                │                     │
│         └────────────────┼────────────────┘                     │
│                          ▼                                      │
│              ┌───────────────────────┐                          │
│              │   FastAPI 后端服务     │                          │
│              │   (业务逻辑中枢)       │                          │
│              └───────────┬───────────┘                          │
│                          │                                      │
│         ┌────────────────┼────────────────┐                     │
│         ▼                ▼                ▼                     │
│   ┌───────────┐   ┌───────────┐   ┌───────────┐                │
│   │  MySQL    │   │ APScheduler│  │  知识库    │                │
│   │  数据库    │   │  任务调度   │   │  (向量库)  │                │
│   └───────────┘   └───────────┘   └───────────┘                │
└─────────────────────────────────────────────────────────────────┘
```

### 2.1 模块组成总览

| 序号 | 模块名称 | 定位 | 核心职责 | 交付物 |
|:----:|----------|------|----------|--------|
| 1 | **微信小程序（患者端）** | 用户交互入口 | 自然语言对话、复诊计划查看、术后知识获取 | 小程序源码、真机测试报告 |
| 2 | **FastAPI 后端服务** | 系统服务中枢 | 业务逻辑、数据持久化、权限控制、任务调度、AI 编排 | API 源码、接口文档、测试报告 |
| 3 | **AI 智能客服引擎** | 系统"大脑" | 领域知识融合、LLM 对话生成、多轮对话管理 | Prompt 模板、知识库、对话日志 |
| 4 | **Streamlit 医护管理后台** | 可视化操作平台 | 方案配置、对话监管、人工干预、数据看板 | 后台源码、操作手册 |
| 5 | **基础设施与支撑体系** | 系统运行保障 | 数据库、部署环境、版本控制、文档体系 | 部署脚本、运维文档、毕业论文 |

---

## 三、各模块详细组成与功能说明

### 3.1 微信小程序（患者端）

#### 3.1.1 模块定位
患者唯一交互入口，提供 7×24 小时自然语言对话服务，支持复诊计划查看、术后知识获取等轻量级功能。

#### 3.1.2 功能组成

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|:--------:|----------|----------|:------:|
| F1-01 | 用户登录/注册 | 微信授权一键登录，自动绑定患者档案 | P0 |
| F1-02 | 智能对话 | 7×24 小时自然语言咨询，支持多轮对话 | P0 |
| F1-03 | 复诊计划查看 | 查看个人复诊时间表、注意事项 | P0 |
| F1-04 | 复诊提醒接收 | 接收微信模板消息提醒（提前 1 天/当天） | P0 |
| F1-05 | 术后知识库 | 浏览常见术后护理知识、FAQ | P1 |
| F1-06 | 人工客服转接 | AI 无法处理时转接人工客服（留言） | P1 |
| F1-07 | 个人信息管理 | 查看/编辑个人基本信息、联系方式 | P2 |

#### 3.1.3 页面结构

```
pages/
├── index/              # 首页（对话主界面）
├── profile/            # 个人中心
├── appointment/        # 复诊计划页
├── knowledge/          # 术后知识库
└── settings/           # 设置页
```

#### 3.1.4 技术选型

| 技术类别 | 具体技术 | 说明 |
|----------|----------|------|
| 前端框架 | 原生微信小程序框架 (WXML/WXSS/JavaScript) | 无需额外构建工具，开发效率高 |
| UI 组件 | 微信官方组件库 + 自定义聊天组件 | 仿微信消息流交互 |
| 网络请求 | wx.request + 封装 API 模块 | 统一处理请求/响应、错误拦截 |
| 状态管理 | 小程序全局数据 + Storage | 存储用户信息、对话历史缓存 |
| 消息推送 | 微信订阅消息 | 复诊提醒模板消息 |

---

### 3.2 FastAPI 后端服务

#### 3.2.1 模块定位
系统服务中枢，统一处理业务逻辑、数据持久化、权限控制、任务调度与 AI 服务编排。

#### 3.2.2 功能组成

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|:--------:|----------|----------|:------:|
| F2-01 | 用户认证授权 | JWT 令牌签发/验证、角色权限控制 | P0 |
| F2-02 | 患者档案管理 | 患者基本信息、治疗记录 CRUD | P0 |
| F2-03 | 复诊计划管理 | 复诊时间生成、修改、取消 | P0 |
| F2-04 | 对话服务接口 | 接收小程序消息、调用 AI 引擎、返回回复 | P0 |
| F2-05 | 提醒任务调度 | 基于 APScheduler 自动推送复诊提醒 | P0 |
| F2-06 | 对话日志记录 | 记录所有 AI 对话内容，供监管审计 | P0 |
| F2-07 | 知识库管理 API | 知识条目 CRUD、向量检索 | P1 |
| F2-08 | 数据统计接口 | 复诊率、对话量等指标统计 | P1 |

#### 3.2.3 目录结构

```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py              # FastAPI 应用入口
│   ├── config.py            # 配置文件
│   ├── database.py          # 数据库连接
│   ├── models/              # SQLAlchemy 模型
│   │   ├── user.py
│   │   ├── patient.py
│   │   ├── appointment.py
│   │   └── dialogue.py
│   ├── schemas/             # Pydantic 数据验证
│   │   ├── user.py
│   │   ├── patient.py
│   │   └── dialogue.py
│   ├── api/                 # API 路由
│   │   ├── auth.py
│   │   ├── patients.py
│   │   ├── appointments.py
│   │   └── dialogue.py
│   ├── services/            # 业务逻辑层
│   │   ├── ai_service.py    # AI 服务调用
│   │   ├── scheduler.py     # 任务调度
│   │   └── notification.py  # 消息推送
│   └── utils/               # 工具函数
│       ├── jwt.py
│       └── security.py
├── tests/                   # 测试用例
├── requirements.txt         # 依赖清单
└── Dockerfile               # 容器化部署
```

#### 3.2.4 技术选型

| 技术类别 | 具体技术 | 说明 |
|----------|----------|------|
| 后端框架 | Python FastAPI | 异步、高性能、OpenAPI 自动文档 |
| 数据库 ORM | SQLAlchemy 2.0 | 异步支持、类型安全 |
| 数据验证 | Pydantic V2 | 请求/响应数据校验 |
| 任务调度 | APScheduler | 本地任务调度，支持 Cron 表达式 |
| 安全认证 | JWT (PyJWT) + RBAC | 令牌认证、角色权限控制 |
| 密码加密 | bcrypt / passlib | 密码哈希存储 |
| API 文档 | Swagger UI / ReDoc | 自动生成，在线调试 |

---

### 3.3 AI 智能客服引擎

#### 3.3.1 模块定位
系统"大脑"，融合领域知识库与大语言模型 (LLM) 能力，实现专业、安全、可解释的牙科修复领域对话生成。

#### 3.3.2 功能组成

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|:--------:|----------|----------|:------:|
| F3-01 | 对话意图识别 | 识别用户问题类型（复诊咨询/术后护理/紧急情况等） | P0 |
| F3-02 | 知识库检索 | 基于用户问题检索相关领域知识 | P0 |
| F3-03 | 提示词构建 | 组装 System Prompt + 上下文 + 知识片段 | P0 |
| F3-04 | LLM 调用 | 调用大模型 API 生回复 | P0 |
| F3-05 | 回复安全过滤 | 敏感词检测、医疗风险拦截 | P0 |
| F3-06 | 多轮对话管理 | Session 状态跟踪、历史上下文维护 | P0 |
| F3-07 | 人工接管触发 | 识别 AI 无法处理场景，触发人工介入 | P1 |

#### 3.3.3 核心流程

```
用户问题 → 意图识别 → 知识检索 → 提示词构建 → LLM 调用 → 安全过滤 → 返回回复
                                    ↓
                              对话日志记录
```

#### 3.3.4 技术选型

| 技术类别 | 具体技术 | 说明 |
|----------|----------|------|
| 大模型底座 | **Qwen2.5-7B-Instruct**（本地部署） | 阿里云通义千问开源模型，7B 参数，优秀的中文理解与生成能力 |
| 训练平台 | **AutoDL 云平台** | 租用 GPU 云服务器（RTX 4090/A100），按需计费，成本可控 |
| 微调框架 | **LLaMA Factory** | 一站式大模型微调工具，支持 LoRA/QLoRA 高效微调，Web UI 操作便捷 |
| 微调方式 | LoRA / QLoRA | 低秩适应微调，大幅降低显存占用与训练时间 |
| 推理框架 | vLLM / Transformers | 高性能推理引擎，支持批量推理与流式输出 |
| 知识存储 | MySQL + Markdown 知识文件 | 结构化知识存储，支持关键词检索与分类查询 |
| 提示工程 | System Prompt + Few-shot + RAG | 多层次提示词模板 + 检索增强生成 |
| 对话状态 | Session ID + History Buffer + Redis | Redis 缓存对话历史，支持多轮上下文追踪 |
| 安全过滤 | 敏感词库 + 规则引擎 + 人工审核 | 拦截错误医疗建议，高风险问题转人工 |

#### 3.3.5 模型微调流程

```
数据准备 → 数据预处理 → LoRA 微调 → 模型评估 → 模型导出 → 部署上线
   ↓            ↓            ↓           ↓           ↓           ↓
收集牙科    格式化为     使用 LLaMA   人工评估 +   合并 LoRA   部署到
修复知识    Alpaca 格式   Factory 训练  自动化测试   权重到基座   AutoDL 服务器
```

#### 3.3.6 知识库内容结构

| 知识类别 | 内容来源 | 示例 |
|----------|----------|------|
| 修复类型知识 | 《口腔修复学》第 8 版 | 固定义齿、活动义齿、种植义齿适应症 |
| 术后护理指南 | 临床路径、医嘱模板 | 术后 24 小时注意事项、饮食建议 |
| 常见问题 FAQ | 临床病例整理 | "种植牙多久能正常咀嚼？" |
| 紧急情况处理 | 医疗规范 | 义齿脱落、剧烈疼痛处理建议 |
| 复诊规范 | 治疗指南 | 不同修复类型的复诊周期 |

---

### 3.4 Streamlit 医护管理后台

#### 3.4.1 模块定位
面向医护人员的可视化操作平台，支持方案配置、对话监管、人工干预与运营数据看板。

#### 3.4.2 功能组成

| 功能编号 | 功能名称 | 功能描述 | 优先级 |
|:--------:|----------|----------|:------:|
| F4-01 | 医护登录 | 独立账号体系，与患者端隔离 | P0 |
| F4-02 | 患者档案管理 | 录入/编辑患者信息、治疗方案 | P0 |
| F4-03 | 复诊计划配置 | 为患者制定复诊时间表 | P0 |
| F4-04 | 对话监控 | 实时查看 AI 对话记录 | P0 |
| F4-05 | 人工干预 | 对特定对话进行人工回复 | P1 |
| F4-06 | 知识库管理 | 添加/编辑/删除知识条目 | P1 |
| F4-07 | 数据看板 | 复诊率、对话量、问题 Top 榜可视化 | P1 |
| F4-08 | 系统配置 | 提醒规则、敏感词配置 | P2 |

#### 3.4.3 页面结构

| 页面名称 | 路由 | 功能说明 |
|----------|------|----------|
| 登录页 | `/` | 医护身份认证 |
| 仪表盘 | `/dashboard` | 关键指标概览、图表展示 |
| 患者管理 | `/patients` | 患者列表、详情、编辑 |
| 复诊管理 | `/appointments` | 复诊计划列表、配置 |
| 对话监管 | `/dialogues` | 对话记录查询、人工干预 |
| 知识库 | `/knowledge` | 知识条目管理 |
| 系统设置 | `/settings` | 系统参数配置 |

#### 3.4.4 技术选型

| 技术类别 | 具体技术 | 说明 |
|----------|----------|------|
| 前端框架 | Streamlit | Python 快速构建数据应用 |
| 可视化 | Plotly Express / Matplotlib | 嵌入图表展示 |
| 表单交互 | Streamlit 原生组件 | 输入框、选择器、表格 |
| 会话管理 | st.session_state | 页面间状态保持 |
| API 调用 | requests 库 | 与 FastAPI 后端通信 |

---

### 3.5 基础设施与支撑体系

#### 3.5.1 模块定位
包括数据库、任务调度器、认证授权、部署环境及全周期开发/测试/文档体系——保障系统可用性与可维护性。

#### 3.5.2 组成内容

| 子模块 | 内容说明 | 交付物 |
|--------|----------|--------|
| **数据库** | MySQL 8.0+，设计规范化表结构 | ER 图、建表脚本、初始化数据 |
| **缓存** | Redis 6.0+ | 对话历史缓存、Session 管理、热点数据缓存 |
| **任务调度** | APScheduler 定时任务配置 | 调度脚本、Cron 配置 |
| **认证授权** | JWT + RBAC 权限体系 | 认证中间件、角色配置表 |
| **AI 部署环境** | AutoDL GPU 服务器 + Docker | Qwen2.5-7B 模型镜像、推理服务 API |
| **部署环境** | Docker 容器化 + Nginx 反向代理 | Dockerfile、docker-compose.yml、Nginx 配置 |
| **版本控制** | Git 代码管理 | GitHub/GitLab 仓库 |
| **测试体系** | 单元测试、接口测试、压力测试 | 测试用例、测试报告 |
| **文档体系** | 系统设计、API 文档、用户手册、毕业论文 | Markdown/Word 文档 |

#### 3.5.3 数据库表结构设计

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| `users` | 用户表（医护/管理员） | id, username, password_hash, role, created_at |
| `patients` | 患者档案表 | id, openid, name, phone, id_card, medical_history |
| `treatment_records` | 治疗记录表 | id, patient_id, treatment_type, treatment_date, dentist |
| `appointments` | 复诊计划表 | id, patient_id, appointment_date, status, reminder_sent |
| `dialogues` | 对话日志表 | id, patient_id, session_id, user_message, ai_response, created_at |
| `knowledge_base` | 知识库表 | id, category, title, content, source, created_at |
| `system_config` | 系统配置表 | id, config_key, config_value, description |

---

## 四、五大核心模块开发顺序与步骤

### 4.1 推荐开发顺序

基于模块依赖关系与开发效率考虑，推荐按以下顺序进行开发：

```
┌──────────────────────────────────────────────────────────────────────────┐
│                          模块开发顺序甘特图                               │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  阶段 1：基础架构      ████████████                                      │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ ① 数据库设计与搭建 → ② FastAPI 后端框架 → ③ 认证授权模块            │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  阶段 2：AI 引擎         ████████████████████████                        │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ ④ 知识库收集整理 → ⑤ Qwen2.5 微调训练 → ⑥ 对话服务接口              │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  阶段 3：患者端          ████████████████████                            │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ ⑦ 微信小程序基础框架 → ⑧ 对话界面 → ⑨ 复诊功能                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  阶段 4：医护后台          ████████████████                              │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ ⑩ Streamlit 后台 → ⑪ 数据看板 → ⑫ 人工干预功能                      │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  阶段 5：集成测试          ██████████                                    │
│  ┌────────────────────────────────────────────────────────────────────┐ │
│  │ ⑬ 联调测试 → ⑭ 性能优化 → ⑮ 部署上线                                │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

### 4.2 详细开发步骤

| 顺序 | 模块/任务 | 前置依赖 | 预计工时 | 关键产出物 |
|:----:|-----------|----------|----------|------------|
| **①** | 数据库设计与搭建 | 无 | 1 周 | ER 图、建表 SQL、初始化脚本 |
| **②** | FastAPI 后端框架 | ① | 2 周 | 项目骨架、路由框架、中间件 |
| **③** | 认证授权模块 | ② | 1 周 | JWT 认证、RBAC 权限控制 |
| **④** | 知识库收集整理 | 无 | 2 周 | 牙科修复知识库（Markdown/JSON） |
| **⑤** | Qwen2.5 微调训练 | ④ | 3 周 | 微调后模型权重、评估报告 |
| **⑥** | 对话服务接口 | ②⑤ | 2 周 | AI 对话 API、多轮对话管理 |
| **⑦** | 微信小程序基础框架 | ② | 1 周 | 小程序项目骨架、登录模块 |
| **⑧** | 对话界面开发 | ⑥⑦ | 2 周 | 聊天 UI、消息收发功能 |
| **⑨** | 复诊功能开发 | ②⑦ | 1 周 | 复诊计划查看、提醒接收 |
| **⑩** | Streamlit 后台 | ② | 2 周 | 医护后台、患者管理、复诊配置 |
| **⑪** | 数据看板开发 | ②⑩ | 1 周 | 复诊率图表、对话统计 |
| **⑫** | 人工干预功能 | ⑥⑩ | 1 周 | 对话监管、人工接管 |
| **⑬** | 系统集成联调 | ⑧⑨⑪⑫ | 2 周 | 联调测试报告、Bug 修复清单 |
| **⑭** | 性能优化与安全测试 | ⑬ | 1 周 | 压力测试报告、安全加固 |
| **⑮** | 部署上线 | ⑭ | 1 周 | 线上运行系统、部署文档 |

---

### 4.3 各模块详细制作步骤

#### 模块一：数据库设计与搭建（步骤①）

**制作流程：**
```
需求分析 → 概念设计 (ER 图) → 逻辑设计 (表结构) → 物理实现 (SQL) → 数据初始化
```

**详细步骤：**

| 步骤 | 任务 | 工具 | 产出 |
|------|------|------|------|
| 1.1 | 分析数据需求，确定实体与关系 | Draw.io / ProcessOn | 实体关系清单 |
| 1.2 | 绘制 ER 图 | Draw.io | ER 图.png |
| 1.3 | 设计表结构（字段、类型、约束） | Excel / Markdown | 数据字典.md |
| 1.4 | 编写建表 SQL 脚本 | DataGrip | create_tables.sql |
| 1.5 | 创建数据库与用户权限 | MySQL CLI | 授权脚本 |
| 1.6 | 插入初始化测试数据 | SQL | init_data.sql |

---

#### 模块二：FastAPI 后端框架（步骤②）

**制作流程：**
```
环境搭建 → 项目初始化 → 模型层 (models) → 路由层 (api) → 服务层 (services) → 单元测试
```

**详细步骤：**

| 步骤 | 任务 | 工具/库 | 产出 |
|------|------|---------|------|
| 2.1 | 创建 Python 虚拟环境，安装依赖 | venv, pip | requirements.txt |
| 2.2 | 初始化 FastAPI 项目结构 | 手动创建 | 目录结构 |
| 2.3 | 配置数据库连接（SQLAlchemy） | SQLAlchemy | database.py |
| 2.4 | 编写数据模型（Models） | SQLAlchemy | models/*.py |
| 2.5 | 编写数据验证 Schema（Pydantic） | Pydantic | schemas/*.py |
| 2.6 | 实现 API 路由（CRUD） | FastAPI | api/*.py |
| 2.7 | 编写业务逻辑层 | 手动编码 | services/*.py |
| 2.8 | 配置 CORS、异常处理中间件 | FastAPI | main.py |
| 2.9 | 编写单元测试 | pytest | tests/*.py |

---

#### 模块三：认证授权模块（步骤③）

**制作流程：**
```
用户表设计 → 密码加密 → JWT 签发 → 认证中间件 → RBAC 权限控制 → 测试验证
```

**详细步骤：**

| 步骤 | 任务 | 工具/库 | 产出 |
|------|------|---------|------|
| 3.1 | 设计 users 表（含 role 字段） | MySQL | users 表 |
| 3.2 | 实现密码哈希加密 | passlib/bcrypt | security.py |
| 3.3 | 实现登录接口，签发 JWT | PyJWT | auth.py |
| 3.4 | 编写认证依赖（Dependency） | FastAPI Depends | dependencies.py |
| 3.5 | 实现 RBAC 权限装饰器 | 自定义 | permissions.py |
| 3.6 | 为 API 路由添加权限保护 | @require_role | 各 API 路由 |
| 3.7 | 测试认证流程 | Postman | 测试报告 |

---

#### 模块四：知识库收集整理（步骤④）

**制作流程：**
```
确定知识范围 → 收集资料 → 数据清洗 → 结构化整理 → 格式转换 → 入库存储
```

**详细步骤：**

| 步骤 | 任务 | 工具 | 产出 |
|------|------|------|------|
| 4.1 | 确定知识分类体系 | Markdown | 知识分类大纲.md |
| 4.2 | 收集权威资料（教材、指南） | 图书馆/数据库 | 参考资料集 |
| 4.3 | 数据清洗与去重 | 手动 + 脚本 | 清洗后文本 |
| 4.4 | 结构化整理（Q&A 格式） | Markdown/JSON | knowledge/*.md |
| 4.5 | 编写数据导入脚本 | Python | import_knowledge.py |
| 4.6 | 导入 MySQL 知识库表 | SQLAlchemy | knowledge_base 表 |
| 4.7 | 验证知识检索功能 | 手动测试 | 检索测试报告 |

---

#### 模块五：Qwen2.5 微调训练（步骤⑤）⭐核心

**制作流程：**
```
AutoDL 环境准备 → 数据集准备 → LLaMA Factory 配置 → 启动训练 → 模型评估 → 模型导出
```

**详细步骤：**

| 步骤 | 任务 | 工具/平台 | 产出 |
|------|------|-----------|------|
| 5.1 | 注册 AutoDL 账号，充值 | AutoDL 官网 | 账号余额 |
| 5.2 | 租用 GPU 实例（RTX 4090 24GB） | AutoDL 控制台 | 实例 ID、SSH 密钥 |
| 5.3 | 配置深度学习环境 | Docker 镜像（PyTorch 2.0+） | 环境配置完成 |
| 5.4 | 安装 LLaMA Factory | pip/源码安装 | LLaMA Factory 可用 |
| 5.5 | 下载 Qwen2.5-7B-Instruct 基座 | ModelScope/HuggingFace | 基座模型 |
| 5.6 | 准备微调数据集（Alpaca 格式） | 步骤④产出 | train.json, dev.json |
| 5.7 | 配置 LoRA 训练参数 | LLaMA Factory WebUI/CLI | train_config.yaml |
| 5.8 | 启动 LoRA 微调训练 | LLaMA Factory | LoRA 权重文件 |
| 5.9 | 模型效果评估（人工 + 自动） | 测试集 | 评估报告.md |
| 5.10 | 合并 LoRA 权重与基座 | LLaMA Factory | 完整模型权重 |
| 5.11 | 模型导出与备份 | AutoDL 网盘 | 模型压缩包 |

**LoRA 训练参数参考：**
```yaml
model_name_or_path: Qwen/Qwen2.5-7B-Instruct
dataset: dental_knowledge
finetuning_type: lora
lora_rank: 8
lora_alpha: 32
learning_rate: 2e-4
num_train_epochs: 3
per_device_train_batch_size: 2
gradient_accumulation_steps: 8
lr_scheduler_type: cosine
warmup_ratio: 0.1
fp16: true
output_dir: checkpoints/dental_qwen_lora
```

---

#### 模块六：对话服务接口（步骤⑥）

**制作流程：**
```
模型部署 → 推理 API 封装 → 对话接口实现 → 多轮对话管理 → 安全过滤 → 日志记录
```

**详细步骤：**

| 步骤 | 任务 | 工具/库 | 产出 |
|------|------|---------|------|
| 6.1 | 部署 Qwen2.5 模型（vLLM/Transformers） | AutoDL 实例 | 推理服务 |
| 6.2 | 封装模型推理 API | FastAPI | ai_inference.py |
| 6.3 | 实现 System Prompt 模板 | 手动编写 | prompt_templates.py |
| 6.4 | 实现知识检索（RAG） | 关键词匹配/向量检索 | retrieval.py |
| 6.5 | 实现对话历史管理 | Redis | dialogue_manager.py |
| 6.6 | 实现敏感词过滤 | 敏感词库 | filter.py |
| 6.7 | 实现对话日志记录 | SQLAlchemy | dialogue 表 |
| 6.8 | 编写对话接口测试用例 | pytest | test_dialogue.py |

---

#### 模块七：微信小程序基础框架（步骤⑦）

**制作流程：**
```
注册小程序账号 → 项目初始化 → 登录模块 → 网络请求封装 → 全局状态管理
```

**详细步骤：**

| 步骤 | 任务 | 工具 | 产出 |
|------|------|------|------|
| 7.1 | 注册微信小程序账号 | 微信公众平台 | AppID |
| 7.2 | 安装微信开发者工具 | 官网下载 | 开发环境 |
| 7.3 | 初始化小程序项目 | 开发者工具 | 项目结构 |
| 7.4 | 实现微信登录（wx.login） | 小程序 API | login.js |
| 7.5 | 封装网络请求模块 | wx.request | utils/api.js |
| 7.6 | 实现全局状态管理 | app.globalData | app.js |
| 7.7 | 配置 tabBar 导航 | app.json | 底部导航栏 |

---

#### 模块八：对话界面开发（步骤⑧）

**制作流程：**
```
UI 设计 → 消息组件 → 输入框 → 消息收发 → 加载状态 → 真机测试
```

**详细步骤：**

| 步骤 | 任务 | 工具 | 产出 |
|------|------|------|------|
| 8.1 | 设计聊天界面 UI | 手绘/墨刀 | UI 设计稿 |
| 8.2 | 实现消息列表组件 | WXML/WXSS | chat/index.wxml |
| 8.3 | 实现输入框与发送按钮 | 小程序组件 | chat/input.wxml |
| 8.4 | 对接后端对话 API | 步骤⑥ | chat/index.js |
| 8.5 | 实现流式消息显示 | 小程序动画 | chat/index.wxss |
| 8.6 | 添加加载状态与错误处理 | 小程序 API | 错误提示 |
| 8.7 | 真机测试与优化 | 微信开发者工具 | 测试报告 |

---

#### 模块九：复诊功能开发（步骤⑨）

**制作流程：**
```
复诊计划 API → 列表页面 → 详情页面 → 订阅消息 → 提醒推送
```

**详细步骤：**

| 步骤 | 任务 | 工具 | 产出 |
|------|------|------|------|
| 9.1 | 实现复诊计划 CRUD API | FastAPI | appointments.py |
| 9.2 | 实现复诊列表页面 | 小程序 | appointment/list.wxml |
| 9.3 | 实现复诊详情页面 | 小程序 | appointment/detail.wxml |
| 9.4 | 申请订阅消息模板 | 微信公众平台 | 模板 ID |
| 9.5 | 实现订阅消息推送 | 后端 + 微信 API | notification.py |
| 9.6 | 配置 APScheduler 定时任务 | APScheduler | scheduler.py |
| 9.7 | 测试提醒推送功能 | 真机 | 测试报告 |

---

#### 模块十：Streamlit 后台（步骤⑩）

**制作流程：**
```
环境搭建 → 登录页面 → 患者管理 → 复诊管理 → 对话监管 → 部署测试
```

**详细步骤：**

| 步骤 | 任务 | 工具/库 | 产出 |
|------|------|---------|------|
| 10.1 | 创建 Streamlit 项目，安装依赖 | pip | requirements.txt |
| 10.2 | 实现登录页面与会话管理 | Streamlit | pages/01_登录.py |
| 10.3 | 实现患者列表与详情 | Streamlit + pandas | pages/02_患者管理.py |
| 10.4 | 实现复诊计划配置 | Streamlit 表单 | pages/03_复诊管理.py |
| 10.5 | 实现对话记录查询 | Streamlit | pages/04_对话监管.py |
| 10.6 | 实现知识库管理 | Streamlit | pages/05_知识库.py |
| 10.7 | 部署测试 | Streamlit Cloud/自建 | 在线访问地址 |

---

#### 模块十一：数据看板开发（步骤⑪）

**制作流程：**
```
统计 API → 图表选型 → 可视化实现 → 交互优化 → 性能优化
```

**详细步骤：**

| 步骤 | 任务 | 工具/库 | 产出 |
|------|------|---------|------|
| 11.1 | 实现数据统计 API | FastAPI | stats.py |
| 11.2 | 设计看板布局 | 手绘/墨刀 | 看板设计稿 |
| 11.3 | 实现复诊率趋势图 | Plotly Express | dashboard.py |
| 11.4 | 实现对话量统计图 | Plotly | dashboard.py |
| 11.5 | 实现问题 Top 榜 | pandas + Plotly | dashboard.py |
| 11.6 | 添加时间筛选器 | Streamlit 组件 | 交互功能 |
| 11.7 | 性能优化（缓存） | st.cache_data | 优化后代码 |

---

#### 模块十二：人工干预功能（步骤⑫）

**制作流程：**
```
人工接管 API → 后台干预界面 → 消息通知 → 工单流转 → 测试验证
```

**详细步骤：**

| 步骤 | 任务 | 工具 | 产出 |
|------|------|------|------|
| 12.1 | 实现人工接管 API | FastAPI | intervention.py |
| 12.2 | 实现干预请求列表 | Streamlit | pages/06_人工干预.py |
| 12.3 | 实现人工回复功能 | Streamlit 表单 | 回复界面 |
| 12.4 | 实现消息通知（微信/短信） | 第三方 API | notification.py |
| 12.5 | 实现工单状态流转 | 状态机 | 工单管理 |
| 12.6 | 测试人工干预流程 | 手动测试 | 测试报告 |

---

### 4.4 模块依赖关系图

```
                    ┌─────────────────┐
                    │   ① 数据库设计   │
                    └────────┬────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
              ▼              ▼              ▼
    ┌─────────────────┐ ┌───────────┐ ┌─────────────┐
    │ ② FastAPI 后端   │ │ ④ 知识库  │ │ ⑦ 小程序框架│
    └────────┬────────┘ └─────┬─────┘ └──────┬──────┘
             │                │               │
    ┌────────┴────────┐       │               │
    │                 │       │               │
    ▼                 ▼       ▼               │
┌─────────┐    ┌──────────┐  │               │
│③ 认证授权│    │⑤ Qwen 微调│  │               │
└─────────┘    └────┬─────┘  │               │
    │               │        │               │
    │               ▼        │               │
    │        ┌──────────┐    │               │
    │        │⑥ 对话服务 │    │               │
    │        └────┬─────┘    │               │
    │             │          │               │
    │             ├──────────┘               │
    │             │                          │
    │             ▼                          ▼
    │    ┌─────────────────┐        ┌───────────────┐
    │    │  ⑧ 对话界面开发  │        │ ⑨ 复诊功能    │
    │    └─────────────────┘        └───────────────┘
    │                                           │
    │                                           │
    ▼                                           │
┌─────────────────────────────────────────────────┐
│            ⑩ Streamlit 后台 + ⑪ 数据看板         │
│                   + ⑫ 人工干预                   │
└─────────────────────────────────────────────────┘
                          │
                          ▼
              ┌───────────────────────┐
              │ ⑬⑭⑮ 集成测试→优化→部署 │
              └───────────────────────┘
```

---

## 五、开发任务分解与时间规划

### 5.1 任务分解（WBS）

| 阶段 | 任务编号 | 任务名称 | 预计工时 | 依赖关系 |
|------|----------|----------|----------|----------|
| **第一阶段：需求分析与设计** (2025.09-2025.10) | T1-01 | 文献调研与需求分析 | 2 周 | - |
| | T1-02 | 系统架构设计 | 1 周 | T1-01 |
| | T1-03 | 数据库设计与 ER 图 | 1 周 | T1-02 |
| | T1-04 | 开题报告撰写 | 1 周 | T1-03 |
| **第二阶段：环境搭建与基础开发** (2025.11-2025.12) | T2-01 | 开发环境搭建 | 1 周 | T1-04 |
| | T2-02 | FastAPI 后端框架搭建 | 2 周 | T2-01 |
| | T2-03 | 数据库建模与迁移 | 1 周 | T2-02 |
| | T2-04 | 微信小程序初始化 | 1 周 | T2-01 |
| **第三阶段：核心功能开发** (2026.01-2026.03) | T3-01 | AI 客服引擎开发 | 3 周 | T2-02 |
| | T3-02 | 对话接口与多轮对话管理 | 2 周 | T3-01 |
| | T3-03 | 复诊提醒任务调度 | 1 周 | T2-02 |
| | T3-04 | Streamlit 后台开发 | 2 周 | T2-02 |
| | T3-05 | 小程序前端开发 | 3 周 | T2-04 |
| **第四阶段：测试与优化** (2026.04) | T4-01 | 单元测试与接口测试 | 1 周 | T3-05 |
| | T4-02 | 真机测试与性能优化 | 1 周 | T4-01 |
| | T4-03 | 安全测试与漏洞修复 | 1 周 | T4-02 |
| **第五阶段：部署与文档** (2026.05) | T5-01 | 云服务器部署 | 1 周 | T4-03 |
| | T5-02 | 毕业论文撰写 | 3 周 | T5-01 |
| | T5-03 | 答辩准备 | 1 周 | T5-02 |

### 5.2 里程碑节点

| 里程碑 | 时间节点 | 交付物 |
|--------|----------|--------|
| M1：开题完成 | 2025.10.31 | 开题报告、系统设计文档 |
| M2：后端完成 | 2026.01.31 | FastAPI 后端源码、API 文档 |
| M3：AI 引擎完成 | 2026.02.28 | AI 客服源码、Prompt 模板、知识库 |
| M4：全功能完成 | 2026.03.31 | 小程序、后台、后端完整系统 |
| M5：测试完成 | 2026.04.30 | 测试报告、性能优化报告 |
| M6：部署完成 | 2026.05.15 | 线上运行系统、部署文档 |
| M7：论文定稿 | 2026.05.31 | 毕业论文、答辩 PPT |

---

## 六、预期交付物清单

### 6.1 软件系统

| 交付物名称 | 形式 | 说明 |
|------------|------|------|
| 微信小程序源码 | 代码仓库 | 完整小程序项目文件 |
| FastAPI 后端源码 | 代码仓库 | 完整后端服务代码 |
| AI 客服引擎源码 | 代码仓库 | AI 服务核心代码、Prompt 模板 |
| Streamlit 后台源码 | 代码仓库 | 医护管理后台代码 |
| 数据库脚本 | SQL 文件 | 建表脚本、初始化数据 |
| 部署脚本 | Shell/Docker | Dockerfile、docker-compose.yml |

### 6.2 文档资料

| 交付物名称 | 形式 | 说明 |
|------------|------|------|
| 系统设计说明书 | Word/PDF | 架构设计、模块说明 |
| API 接口文档 | 在线/Markdown | Swagger 自动生成 |
| 数据库设计文档 | Word/PDF | ER 图、表结构说明 |
| 用户操作手册 | Word/PDF | 小程序与后台使用说明 |
| 部署运维手册 | Word/PDF | 部署步骤、运维指南 |
| 测试报告 | Word/PDF | 功能测试、性能测试结果 |
| 毕业论文 | Word/PDF | 符合学校格式要求的论文 |
| 答辩 PPT | PPTX | 答辩汇报演示文稿 |

---

## 七、技术风险与应对措施

| 风险项 | 风险等级 | 影响 | 应对措施 |
|--------|----------|------|----------|
| 大模型输出不可控 | 高 | 可能产生错误医疗建议 | System Prompt 约束 + 敏感词过滤 + 人工接管机制 |
| 微信小程序审核不通过 | 中 | 影响系统上线 | 提前了解医疗类小程序审核规范，准备备选方案（H5） |
| 服务器性能不足 | 中 | 高并发时响应慢 | 采用异步框架 + 缓存优化 + 压力测试提前发现瓶颈 |
| 数据安全风险 | 高 | 患者隐私泄露 | JWT 认证 + 数据加密存储 + 最小权限原则 |
| 开发进度延期 | 中 | 影响论文提交 | 制定详细 WBS，每周进度检查，优先完成 P0 功能 |

---

## 八、附录

### 附录 A：技术栈汇总

| 类别 | 技术名称 | 版本 | 用途 |
|------|----------|------|------|
| 前端 | 微信小程序 | 最新 | 患者端交互界面 |
| 后端 | FastAPI | 0.100+ | RESTful API 服务 |
| 后端 | Python | 3.10+ | 后端开发语言 |
| 数据库 | MySQL | 8.0+ | 关系型数据存储 |
| 缓存 | Redis | 6.0+ | 对话历史缓存、Session 管理 |
| AI 模型 | Qwen2.5-7B-Instruct | 本地部署 | 牙科修复领域对话生成 |
| AI 训练 | LLaMA Factory | 最新 | LoRA/QLoRA 高效微调 |
| AI 推理 | vLLM / Transformers | 最新 | 高性能模型推理 |
| 训练平台 | AutoDL 云平台 | - | GPU 服务器租用 |
| 后台 | Streamlit | 1.28+ | 医护管理后台 |
| 可视化 | Plotly Express | 最新 | 数据看板图表 |
| 调度 | APScheduler | 4.0+ | 定时任务调度 |
| 认证 | PyJWT | 2.8+ | JWT 令牌认证 |
| 部署 | Docker | 最新 | 容器化部署 |
| 部署 | Nginx | 最新 | 反向代理 |

### 附录 B：参考文档

1. 《口腔修复学》第 8 版，人民卫生出版社
2. FastAPI 官方文档：https://fastapi.tiangolo.com/
3. 微信小程序开发文档：https://developers.weixin.qq.com/miniprogram/dev/framework/
4. Streamlit 官方文档：https://docs.streamlit.io/
5. Qwen2.5 官方文档：https://qwen.readthedocs.io/
6. LLaMA Factory GitHub：https://github.com/hiyouga/LLaMA-Factory
7. AutoDL 官方文档：https://www.autodl.com/
8. vLLM 官方文档：https://docs.vllm.ai/

---

## 九、文档更新记录

| 版本 | 更新日期 | 更新内容 | 更新人 |
|------|----------|----------|--------|
| v1.0 | 2026-02-21 | 初始版本，完成系统整体设计 | - |
| v1.1 | 2026-02-21 | 补充技术选型和开发步骤 | - |
| v1.2 | 2026-02-22 | 校对文档与代码一致性，完善 API 接口说明 | - |
| v1.3 | 2026-02-25 | 调整数据集目标（1500 条知识库 +1000 条训练集） | AI 助手 |

---

**文档版本**：v1.3
**编制日期**：2026 年 2 月 25 日
**适用对象**：学生本人、指导教师、答辩委员会
